---
title: "Is temporal synchrony necessary for effective Batesian mimicry?"
author: "Abby Robinson"
date: "12/16/2022"
output: html_document
---

# Packages

The following packages were used for this statistical analysis 

```{r packages}
library(curl)
library(ggplot2)
library(lme4)
library(DHARMa)
library(emmeans)
library("glmmTMB")
library(patchwork)
library(performance)
library(ggmap)
library(googleway)
library("rstudioapi")
library(ggpattern)
library(tidyverse)
library(car)
```

We used the "DHARMa" package to check residuals and model assumptions 
```{r DHARMa Vignette}
vignette("DHARMa", package="DHARMa") ### Useful information for checking residuals/ model assumptions 
```

## Assumptions for Generalized Linear Mixed Models (GLMMs) with Poisson Distribution

1. The variance is equal to the mean. Overdispersion can occur when your variance is much higher than your mean. DHARMa provides effective tools to quantify overdispersion, and when it is present, you would want to consider quasi-Poisson, negative binomial, or zero-inflated models (see CRAN package link above). 
2. The response variable is non-negative integer data. 
3. The responses are independent from one another. 
4. The responses occur over fixed time or space. 

#Training Phase Models 
STATISTICAL QUESTIONS:
1. Did avian predators learn to avoid facsimiles of Battus philenor during 4-day experiment? 
2. Did avian predators learn to avoid facsimiles of the control during the 4-day experiment? 

In order to address how the time delay will affect attack rates on the mimics, we first need to show that our training experiment was effective and birds learned to avoid facsimiles of battus philenor. 

I hypothesize that birds will learn to avoid the chemically defended model, but not the control, and that we will therefore see lower attack rates on the model in the last three days of the experiment compared to the control. 

Because this initial question of the project is focused on the training phase of the experiment, each of the three time-delayed experiments (four, two, one) are essentially identical replicates of each other, with transecct included as a fixed effect in the model 

##Prepping Data 

Load data from GitHub repo using "curl()" command 

```{r pull model data}
m <- curl("https://raw.githubusercontent.com/butterfliesrcool/Temporal_Synchrony_Predation_Experiments/main/data/predation_data/Quabbin_Model_Data.csv")
model <- read.csv(m, header = TRUE, sep = ",")
head(model)

# count data looses some information that binomial data would provide, but binomial data would likely not work here due to the low overall attack rates 

```

Making sure R is "reading" the variables field.day, experiment.day, field.site, species, and treatment at factors. Attacks variable should be an integer value 

```{r check data type}
# check data structure 
str(model)

model$transect <- as.factor(model$transect)

model$experiment.day <- factor(model$experiment.day, order = TRUE, levels = c("1", "2", "3", "4"))

model$field.day <- as.factor(model$field.day)

model$field.site <- as.factor(model$field.site)

model$attacks <- as.numeric(model$attacks)

str(model)

```

## Visualize Data 

```{r checking variance assumptions}
# histogram of attacks 
hist(model$attacks)  #concerns about zero inflation based on histogram? 

# check variance and mean to assess for over /  under - dispersion 
var(model$attacks)
mean(model$attacks) # variance is greater than mean, which indicates that over-dispersion might be an issue 
```

```{r aggregate}
# summarizing attacks 
aggregate(x= model$attacks, by= list(model$experiment.day, model$species), FUN=sum)

aggregate(x= model$attacks, by= list(model$transect), FUN=sum)
```

##glmmTMB Models with interactions

run model  to assess two questions: 
1. did birds learn to avoid facsimiles of the model across four days? 
2. did birds learn to avoid facsimiles of the control across four days? 

```{r merge with site GPS coordinates}

## source for spatial corelation correction in model: https://cran.r-project.org/web/packages/glmmTMB/vignettes/covstruct.html

d <- curl("https://raw.githubusercontent.com/butterfliesrcool/Temporal_Synchrony_Predation_Experiments/main/data/Quabbin_GIS_Data.csv")
map <- read.csv(d, header = TRUE, sep = ",")
head(map)

#merge training phase data set with GPS coordinates
lat_long <- subset(map, select = c(site, latitude, longitude) )
colnames(lat_long) <- c("field.site", "latitude", "longitude")
head(lat_long)
model <- merge(model, lat_long, by="field.site", all.x = TRUE)
```

```{r training phase models}

model$attacks <- as.vector(model$attacks)
model$latitude <- as.vector(model$latitude)
model$longitude <- as.vector(abs(model$longitude)) #absolute value of longitude. glmmtmb cannot interpret negative values 

model$pos <- numFactor(model$longitude, model$latitude)
model$group <- factor(rep(1, nrow(model)))

#all random effects 
mod1 <- glmmTMB(attacks ~ experiment.day*species + transect + 
                  (1|field.site/field.day) + exp(pos + 0 | group), 
                data = model, ziformula=~1, family=poisson) #model doesn't converge 
summary(mod1) #model does not converge 
check_singularity(mod1) #yes
Anova(mod1, type = "III") 

#no random effects 
mod2 <- glmmTMB(attacks ~ experiment.day*species + transect + exp(pos + 0 | group), 
                data = model, ziformula=~1, family=poisson) 
summary(mod2)
check_singularity(mod2) #no singularity issues
Anova(mod2, type = "III") 

#only field site random effect 
mod3 <- glmmTMB(attacks ~ experiment.day*species + transect + (1|field.site) + exp(pos + 0 | group), 
                data = model, ziformula=~1, family=poisson) 
summary(mod3) #model does not converge 
check_singularity(mod3) #yes 
Anova(mod3, type = "III") 

#only field day random effect
mod4 <- glmmTMB(attacks ~ experiment.day*species + transect + (1|field.day) + exp(pos + 0 | group), 
                data = model, ziformula=~1, family=poisson) 
summary(mod4)
check_singularity(mod4) #false 
Anova(mod4, type = "III") 

#run model comparisons 
anova(mod2, mod4) 
anova(mod1, mod2, mod3, mod4) 
## models are not significantly different - mod2 has a lower AIC score 
```

###Check residuals 

```{r check residuals}
mod2simulation <- simulateResiduals(fittedModel = mod2, plot = T)

testUniformity(mod2simulation) 
testOutliers(mod2simulation)
testDispersion(mod2simulation) 
testZeroInflation(mod2simulation) 

#residuals look good 
```

###Planned pairwise contrasts 

```{r training phase planned contrasts }
library(emmeans)
EMM <- emmeans(mod2,  pairwise ~ experiment.day|species)
pairs(EMM)
pairs(EMM, adjust = "bonferroni")
```

# Testing Phase Models 
Biological question: When is limenitis protected from predation (four-week exp, two-week exp, one-week exp, or simultaneous exp)?

Now that we have established that the bird community at the Quabbin Reservoir did learn to avoid facsimiles of the model species Battus philenor, we can explore how the birds responded to the mimics. In each location where birds learned to avoin the model, we returned at different times (4 weeks later, 2 weeks later, one week later, or simultaneously (zero weeks)), presented the mimic and the control, and examined how birds responded to the mimic under different temporal delay treatments. 

Previous lab work and models of pavlovian learning suggest that predators should be able to retain memory of negative stimuli for long periods of time after that negative stimulus is removed. Here, we are examining how long after a negative stimulus is removed predators in natural environments retain memory of that negative model stimulus & avoid mimics. 

STATISTICAL QUESTIONS: 
1. Do birds in T4 attack the mimic significantly less than the control? 
2. Do birds in T2 attack the mimic significatly less than the control? 
3. Do birds in T1 attack the mimic significantly less than the control? 
4. Do birds in T0 attack the mimic significantly less than the control?

## Prepping Data 

Load data file from GitHub repo

```{r pull mimic data }
c <- curl("https://raw.githubusercontent.com/butterfliesrcool/Temporal_Synchrony_Predation_Experiments/main/data/predation_data/Quabbin_Mimic_Data.csv")
mimic <- read.csv(c, header = TRUE, sep = ",")
head(mimic)
```

Making sure R is "reading" the variables field.day, experiment.day, field.site, species, and treatment at factors. Attacks variable should be an integer value 

```{r check data type}
# check data structure 
str(mimic)

mimic$attacks <- as.numeric(mimic$attacks)

mimic$treatment <- as.factor(mimic$treatment)

mimic$species <- as.factor(mimic$species)

mimic$experiment.day <- factor(mimic$experiment.day, order = TRUE, levels = c("1", "2", "3", "4"))

mimic$field.day <- as.factor(mimic$field.day)

mimic$field.site <- as.factor(mimic$field.site)

str(mimic)
```

## Visualize Data 

```{r check variance assumptions}
# histogram of attacks 
hist(mimic$attacks)  #concerns about zero inflation based on histogram? 

# check variance and mean to assess for over /  under - dispersion 
var(mimic$attacks)
mean(mimic$attacks) # variance is greater than mean, which indicates that over-dispersion might be an issue 
```

## glmmTMB models with interactions 

```{r merge data with GPS coordinates}
#testing phase model 
#merge training phase data set with GPS coordinates
lat_long <- subset(map, select = c(site, latitude, longitude) )
colnames(lat_long) <- c("field.site", "latitude", "longitude")
head(lat_long)
mimic <- merge(mimic, lat_long, by="field.site", all.x = TRUE)

```

```{r testing  phase models}

#define parameters 
mimic$attacks <- as.vector(mimic$attacks)
mimic$latitude <- as.vector(mimic$latitude)
mimic$longitude <- as.vector(abs(mimic$longitude)) #absolute value of longitude. glmmtmb cannot interpret negative values 

mimic$pos <- numFactor(mimic$longitude, mimic$latitude)
mimic$group <- factor(rep(1, nrow(mimic), times = 1))

#all random effects 
mod5 <- glmmTMB(attacks ~ species*treatment + (1|field.site) + (1|field.day) + 
                  exp(pos + 0 | group), 
                data = mimic, ziformula=~1, family=poisson) 
summary(mod5)
Anova(mod5, type = "III") 

#no random effects 
mod6 <- glmmTMB(attacks ~ species*treatment + exp(pos + 0 | group), 
                data = mimic, ziformula=~1, family=poisson) 
summary(mod6) # model does not converge 
Anova(mod6, type = "III") 

#only field site random effect 
mod7 <- glmmTMB(attacks ~ species*treatment + (1|field.site) + exp(pos + 0 | group), 
                data = mimic, ziformula=~1, family=poisson) 
summary(mod7) #model does not converge
Anova(mod7, type = "III") 

#only field day random effect
mod8 <- glmmTMB(attacks ~ species*treatment + (1|field.day) + exp(pos + 0 | group), 
                data = mimic, ziformula=~1, family=poisson) 
summary(mod8)
Anova(mod8, type = "III") 

#run model comparisons 
anova(mod5, mod8) 
## mod 5 is significantly better - lower AIC score 
```

###Check residuals 

```{r check residuals}
mod5simulation <- simulateResiduals(fittedModel = mod5, plot = T)

testUniformity(mod5simulation) 
testOutliers(mod5simulation)
testDispersion(mod5simulation) 
testZeroInflation(mod5simulation) 

#residuals look good 
```

###Planned pairwise contrasts 
```{r run planned contrasts}
EMM2 <- emmeans(mod5,  pairwise ~ species|treatment)
pairs(EMM2)
pairs(EMM2, adjust = "bonferroni")

```


#Chi squared analysis for synchronous treatment 
```{r synchronous treatment }
#synchronous treatment analysis with battus data 
#it is unnecessary to run a full model for this since we are simply comparing counts across three groups. Random affects of site and spatial and temporal confounds are not relevant here because all three species were placed in the exact same sites on the exact same days. 

s <- curl("https://raw.githubusercontent.com/butterfliesrcool/Temporal_Synchrony_Predation_Experiments/main/data/predation_data/synch_treatment_data.csv")
synch_treatment_data <- read.csv(s, header = TRUE, sep = ",")

#use aggregate function to get the total number of attacks for each species from synch_treatment_data
synch_attack_totals <- aggregate(x= synch_treatment_data$attacks, by= list(synch_treatment_data$species), FUN=sum)
colnames(synch_attack_totals) <- c("species", "attacks")

x <- synch_attack_totals$attacks
#remove NA values from x
x <- x[!is.na(x)]
x
library(rstatix)
chisq_test(x) #p val = 0.0162
pairwise_chisq_gof_test(x, p.adjust.method = "none")
#no p vlaue adjustment is needed because we are running all possible comparisons of the data 
```

# Models without interactions 

## Training Phase 
```{r remove sites with no attacks }
# remove sites with no attacks to improve model fit to Poisson distribution 
model_attackbysite <- aggregate(x=model$attacks, by = list(model$field.site), FUN=sum)
colnames(model_attackbysite) <- c("site", "attacks")
model_attackbysite_noNA <- subset(model_attackbysite, attacks > 0) 
attacked_sites <- model_attackbysite_noNA$site

model_reduced_zeros <- subset(model, field.site %in% attacked_sites)

# remake histograms 
hist(model_reduced_zeros$attacks) # still zero inflated, but better 
```

```{r define data }
# subset data by species 
battus <- subset(model_reduced_zeros, species == "battus")
junonia <- subset(model_reduced_zeros, species == "junonia")

# histograms to assess data distribution 
hist(battus$attacks)
hist(junonia$attacks)
```

```{r model battus}
## models are not converging - likely due to overparameterization
# battus 

# we include transect as a fixed effect in this model to assess the effect of space and time on attack rates 
mod_battus <- glmmTMB(attacks ~ experiment.day + transect + (1|field.site/field.day),
                data = battus, ziformula=~1, family=poisson) 
summary(mod_battus)
check_singularity(mod_battus) #yes 
Anova(mod_battus, type = "III")

##both site and field day have very low varience, which means these might not be meaningful random effects 

d1 <- diagnose(mod_battus) # model is not converging 

# model does not converge with random effects - random effects are likely too small, making the model overparameterized - remove all random effects 
mod_battus2 <- glmmTMB(attacks ~ experiment.day + transect, 
                data = battus, ziformula=~1, family=poisson) 
summary(mod_battus2)
check_singularity(mod_battus2) #no 
Anova(mod_battus2, type = "III") # significant effect of experiment day 
# no effect of transect (space & time) 


#try model with just site as random effect 
mod_battus3 <- glmmTMB(attacks ~ experiment.day + transect + (1|field.site), 
                data = battus, ziformula=~1, family=poisson) 
summary(mod_battus3)
check_singularity(mod_battus3) #yes 
Anova(mod_battus3, type = "III") #significance hasn't changed 

#try model with just field day as random effect 
mod_battus4 <- glmmTMB(attacks ~ experiment.day + transect + (1|field.day), 
                data = battus, ziformula=~1, family=poisson) 
summary(mod_battus4)
check_singularity(mod_battus4) #yes 
Anova(mod_battus4, type = "III")

#compare model fit with likelihood ratio test
anova(mod_battus, mod_battus2, mod_battus3, mod_battus4) # models are not significantly different - let's go with the one that does not include random effects beecause its the only one that didn't have singularity issues 
```

```{r model junonia}
## models are not converging - likely due to overparameterization
# junonia (control) 

mod_junonia <- glmmTMB(attacks ~ experiment.day + transect + (1|field.site/field.day), 
                data = junonia, ziformula=~1, family=poisson) 
summary(mod_junonia)
check_singularity(mod_junonia) #singularity issues 
Anova(mod_junonia, type = "III")

#both site and field day have very low varience, which means these might not be meaningful random effects 

#try model with no random effects 
mod_junonia2 <- glmmTMB(attacks ~ experiment.day + transect, 
                data = junonia, ziformula=~1, family=poisson) 

summary(mod_junonia2)
check_singularity(mod_junonia2) #no  
#we should go with model mod_junonia2 because this one does not have singularity issues 
Anova(mod_junonia2, type = "III") # experiment day not significant 


#try model with just site as a random effect 
mod_junonia3 <- glmmTMB(attacks ~ experiment.day + transect + (1|field.site), 
                data = junonia, ziformula=~1, family=poisson) 
summary(mod_junonia3)
check_singularity(mod_junonia3) #singularity issues 
Anova(mod_junonia3, type = "III")

#try model with just field day as a random effect
mod_junonia4 <- glmmTMB(attacks ~ experiment.day + transect + (1|field.day), 
                data = junonia, ziformula=~1, family=poisson) 
summary(mod_junonia4)
check_singularity(mod_junonia4) #singularity issues 
Anova(mod_junonia4, type = "III")


anova(mod_junonia, mod_junonia2, mod_junonia3, mod_junonia4) 
## model 4 is significantly different - is this better or worse? 
```


## Check residuals with "DHARMa" package 

```{r mod_battus residuals }
packageVersion("DHARMa")
mod1simulation <- simulateResiduals(fittedModel = mod_battus2, plot = T)

testUniformity(mod1simulation) 
testOutliers(mod1simulation)
testDispersion(mod1simulation) 
testZeroInflation(mod1simulation) 
```

```{r mod_junonia residuals }
packageVersion("DHARMa")
mod2simulation <- simulateResiduals(fittedModel = mod_junonia2, plot = T)

testUniformity(mod2simulation) 
testOutliers(mod2simulation)
testDispersion(mod2simulation) 
testZeroInflation(mod2simulation) 
```

## Post Hoc Tests 
Post Hoc test allows us to compare attacks on each experimental day for battus  

```{r mod_battus post hoc}
# run post hoc test on battus because fitted model showed significant effect of day. 

EMM <- emmeans(mod_battus2, ~ experiment.day)   # where treat has 2 levels
pairs(EMM) # no p value correction 
pairs(EMM, adjust = "bonferroni") # bonferroni p-value adjustment for planned comparisons 

# attacks on Junonia did not vary significantly across days 
```

## Testing Phase 
To control for spatial confounds, our models only compare attacks on mimic facsimiles to attacks on control facsimiles within each treatment, not across treatment. 

```{r remove sites with no attacks }
mimic_attackbysite <- aggregate(x=mimic$attacks, by = list(mimic$field.site), FUN=sum)
colnames(mimic_attackbysite) <- c("site", "attacks")
mimic_attackbysite_noNA <- subset(mimic_attackbysite, attacks > 0) 
attacked_sites <- mimic_attackbysite_noNA$site

mimic_reduced_zeros <- subset(mimic, field.site %in% attacked_sites)

# remake histograms to assess data distribution 
hist(mimic_reduced_zeros$attacks) # still zero inflated, but better 
```

```{r define data }

# subset treatments because we are not comparing across treatments 
T4 <- subset(mimic_reduced_zeros, treatment == "four")
T2 <- subset(mimic_reduced_zeros, treatment == "two")
T1 <- subset(mimic_reduced_zeros, treatment == "one")
T0 <- subset(mimic_reduced_zeros, treatment == "zero")

# make histograms to assess data distribution by treatment 
hist(T4$attacks)
hist(T2$attacks)
hist(T1$attacks)
hist(T0$attacks)

```

```{r T4 model}
mod_T4 <- glmmTMB(attacks ~ species + (1|field.site) + (1|field.day),
                data=T4, ziformula=~1, family=poisson) 
summary(mod_T4)
check_singularity(mod_T4) #singularity issue 
Anova(mod_T4, type = "III") # not significant 

#remove field site as random effect (it has the lowest variance)
mod_T4_2 <- glmmTMB(attacks ~ species  + (1|field.day),
                data=T4, ziformula=~1, family=poisson) 
summary(mod_T4_2)
check_singularity(mod_T4_2) #false 
Anova(mod_T4_2, type = "III") 

# remove field day as random effect 
mod_T4_3 <- glmmTMB(attacks ~ species  + (1|field.site),
                data=T4, ziformula=~1, family=poisson) # model does not converge 
summary(mod_T4_3)
check_singularity(mod_T4_3) #true 
Anova(mod_T4_3, type = "III") 

# remove both random effects 
mod_T4_4 <- glmmTMB(attacks ~ species,
                data=T4, ziformula=~1, family=poisson) 
summary(mod_T4_4)
check_singularity(mod_T4_4) #false 
Anova(mod_T4_4, type = "III") 

anova(mod_T4, mod_T4_2, mod_T4_3, mod_T4_4) # no significant difference between models. Model without random effects has the lowest AIC score 
```

```{r T2 model}
mod_T2 <- glmmTMB(attacks ~ species + (1|field.site) + (1|field.day),
                data=T2, ziformula=~1, family=poisson) 
summary(mod_T2) # model convergence problem 
check_singularity(mod_T2) #false 
Anova(mod_T2, type = "III") # not significant 

# remove field day random effect 
mod_T2_2 <- glmmTMB(attacks ~ species + (1|field.site),
                data=T2, ziformula=~1, family=poisson) 
summary(mod_T2_2) # convergence problem resolved 
check_singularity(mod_T2_2) # no singularity issues 
Anova(mod_T2_2, type = "III") # not significant 

# remove field site random effect 
mod_T2_3 <- glmmTMB(attacks ~ species + (1|field.day),
                data=T2, ziformula=~1, family=poisson) 
summary(mod_T2_3) # convergence problem resolved 
check_singularity(mod_T2_3) # no singularity issues 
Anova(mod_T2_3, type = "III")

# remove both random effects 
mod_T2_4 <- glmmTMB(attacks ~ species,
                data=T2, ziformula=~1, family=poisson) 
summary(mod_T2_4) # convergence problem resolved 
check_singularity(mod_T2_4) # no singularity issues 
Anova(mod_T2_4, type = "III")

#likelihood ratio test 
anova(mod_T2, mod_T2_2, mod_T2_3, mod_T2_4)
# model 3 is significantly better - lower AIC and lower deviance 
```

```{r T1 model}
mod_T1 <- glmmTMB(attacks ~ species + (1|field.site) + (1|field.day),
                data=T1, ziformula=~1, family=poisson) 
summary(mod_T1)
check_singularity(mod_T1) 
Anova(mod_T1, type = "III") # not significant 

## Model looks good and there are no singularity issues, but variance for the random effects is still vary low. Let's see if removing the random effects improves the model

#removing both random effects 
mod_T1_2 <- glmmTMB(attacks ~ species,
                data=T1, ziformula=~1, family=poisson) 
summary(mod_T1_2)
check_singularity(mod_T1_2) #false
Anova(mod_T1_2, type = "III") 

#removing just field site
mod_T1_3 <- glmmTMB(attacks ~ species + (1|field.day),
                data=T1, ziformula=~1, family=poisson)  #model does not converge 
summary(mod_T1_3)
check_singularity(mod_T1_3) #true 
Anova(mod_T1_3, type = "III")

#removing just field day 
mod_T1_4 <- glmmTMB(attacks ~ species + (1|field.site),
                data=T1, ziformula=~1, family=poisson) #model does not converge 
summary(mod_T1_4)
check_singularity(mod_T1_4) #true 
Anova(mod_T1_4, type = "III") 

anova(mod_T1, mod_T1_2, mod_T1_3, mod_T1_4) #no significant difference between models 1 and 2, but we have to either keep both random effects or remove both 
```

```{r T0 model}

mod_T0 <- glmmTMB(attacks ~ species + (1|field.site) + (1|field.day),
                data=T0, ziformula=~1, family=poisson) 
summary(mod_T0)
check_singularity(mod_T0) # singular 
Anova(mod_T0, type = "III") # significant effect of species 

# model looks good, but variance of random effects is very low and model has singularity issues, so lets see what happens when we remove some random effects 

#remove field day 
mod_T0_2 <- glmmTMB(attacks ~ species + (1|field.site),
                data=T0, ziformula=~1, family=poisson) 
summary(mod_T0_2)
check_singularity(mod_T0_2) #true
Anova(mod_T0_2, type = "III")

#remove field site 
mod_T0_3 <- glmmTMB(attacks ~ species + (1|field.day),
                data=T0, ziformula=~1, family=poisson) 
summary(mod_T0_3)
check_singularity(mod_T0_3) #true
Anova(mod_T0_3, type = "III")

#remove both 
mod_T0_4 <- glmmTMB(attacks ~ species,
                data=T0, ziformula=~1, family=poisson) 
summary(mod_T0_4)
check_singularity(mod_T0_4) #false 
Anova(mod_T0_4, type = "III")

anova(mod_T0, mod_T0_2, mod_T0_3, mod_T0_4)
# why is model 3 significant? model 4 has the lowest AIC and is the only one without singularity issues 
```

## check residuals 

```{r mod_T4}
mod3simulation <- simulateResiduals(fittedModel = mod_T4, plot = T)
testUniformity(mod3simulation)  # significant KS test 
testOutliers(mod3simulation)
testDispersion(mod3simulation) 
testZeroInflation(mod3simulation) 
```

```{r mod_T2}
mod4simulation <- simulateResiduals(fittedModel = mod_T2, plot = T)
testUniformity(mod4simulation)
testOutliers(mod4simulation)
testDispersion(mod4simulation) 
testZeroInflation(mod4simulation) 
```

```{r mod_T1}
mod5simulation <- simulateResiduals(fittedModel = mod_T1, plot = T)
testUniformity(mod5simulation) # significant KS test 
testOutliers(mod5simulation)
testDispersion(mod5simulation) 
testZeroInflation(mod5simulation) 
```

```{r mod_T0}
mod6simulation <- simulateResiduals(fittedModel = mod_T0, plot = T)
testUniformity(mod6simulation) # significant deviations from uniformity 
testOutliers(mod6simulation)
testDispersion(mod6simulation) 
testZeroInflation(mod6simulation) 
```


# Figures

## training  phase figure 

### Visualizing attack data 

```{r data length }
length(model$attacks)
```

```{r aggregate}
# Summary of attacks on facsimiles during learning  phase 
aggregate(x= model$attacks, by= list(model$experiment.day, model$species), FUN=sum)
```

### Confidence Intervals 

```{r subset B.philenor}
# subset model data (battus philenor)
b <- subset(model, species == "battus", drop = FALSE)

b_attacked <- aggregate(x=b$attacks, by = list(b$species, b$experiment.day), FUN=sum)
b_attacked
```

```{r subset J.coenia}
# subset control data (junonia coenia)
j <- subset(model, species == "junonia", drop = FALSE)
j_attacked <- aggregate(x=j$attacks, by = list(j$species, j$experiment.day), FUN=sum)
j_attacked
```

```{r Calculate SD}
# subset each day within each species to calculate a confidence interval for the count total of facsimiles attacked  each experimental day 

  # battus philenor (model)
b1 <- subset(b, experiment.day == "1", drop = FALSE)
b2 <- subset(b, experiment.day == "2", drop = FALSE)
b3 <- subset(b, experiment.day == "3", drop = FALSE)
b4 <- subset(b, experiment.day == "4", drop = FALSE)

  # junonia coenia (control)
j1 <- subset(j, experiment.day == "1", drop = FALSE)
j2 <- subset(j, experiment.day == "2", drop = FALSE)
j3 <- subset(j, experiment.day == "3", drop = FALSE)
j4 <- subset(j, experiment.day == "4", drop = FALSE)

# calculate standard deviation of attacked proportion 

  # battus philenor (model)
b1.sd <- sd(b1$attacks)
b2.sd <- sd(b2$attacks)
b3.sd <- sd(b3$attacks)
b4.sd <- sd(b4$attacks)

  # junonia coenia (control)
j1.sd <- sd(j1$attacks)
j2.sd <- sd(j2$attacks)
j3.sd <- sd(j3$attacks)
j4.sd <- sd(j4$attacks)
```


```{r new data frame with SD}
# create a new data frame with the experimental day info, attack proportion, and confidence interval for each species 

  # battus philenor (model)
battus_plot_data <- data.frame(
  Day      = b_attacked$Group.2,
  Attacked = b_attacked$x,
  SD       = c(b1.sd, b2.sd, b3.sd, b4.sd)
)
battus_plot_data

  # junonia coenia (control)
junonia_plot_data <- data.frame(
  Day      = j_attacked$Group.2,
  Attacked = j_attacked$x,
  SD       = c(j1.sd, j2.sd, j3.sd, j4.sd)
)
junonia_plot_data
```

### Battus philenor Figure 

```{r B.pilenor figure}
p_value2 <- tibble(
  x = c("1", "1", "2", "2"),
  y = c(22, 23, 23, 6)
)

p_value3 <- tibble(
  x = c("1", "1", "3", "3"),
  y = c(23.5, 24.5, 24.5, 6)
)

p_value4 <- tibble(
  x = c("1", "1", "4", "4"),
  y = c(25, 26, 26, 5)
)


b.plot <- ggplot(battus_plot_data) + 

  geom_bar( aes(Day, Attacked), stat="identity", fill="grey70", width=1) + 
  ylim(0,26) +  xlab("Day") +  ylab("Facsimiles Attacked") + 
  geom_text(aes(x=Day, y=Attacked, label = Attacked), vjust = -1) +
  ggtitle(expression(bolditalic("Battus philenor"))) + 
  geom_errorbar( aes(x=Day, ymin=Attacked-SD, ymax=Attacked+SD), width=0.2, size=0.7) + 
  theme_classic() + 
  theme( aspect.ratio = 4/3, 
         plot.title = element_text(hjust = 0.5, size=17), 
         axis.title = element_text(size = 15), 
         axis.text = element_text(size = 15)) + 
  geom_line(data = p_value2, 
            aes(x = x, y = y, group = 1)) +
  geom_line(data = p_value3, 
            aes(x = x, y = y, group = 1)) + 
  geom_line(data = p_value4, 
            aes(x = x, y = y, group = 1)) + 
  geom_text(x=1.6, y=23.75, label="P=0.0117*") +
  geom_text(x=2, y=25.25, label="P=0.0117*") +
  geom_text(x=2.5, y=26.75, label="P=0.0103*") 
  
b.plot 
```

### Junonia coenia Figure 

```{r J.coenia figure}
p_value2j <- tibble(
  x = c("1", "1", "2", "2"),
  y = c(18, 19, 19, 12)
)

p_value3j <- tibble(
  x = c("1", "1", "3", "3"),
  y = c(19.5, 20.5, 20.5, 7)
)

p_value4j <- tibble(
  x = c("1", "1", "4", "4"),
  y = c(21, 22, 22, 11)
)


j.plot <- ggplot(junonia_plot_data) +
  geom_bar( aes(Day, Attacked), stat="identity", fill="gray35", width=1) + 
  ylim(0,26) +  xlab("Day") +  ylab("Facsimiles Attacked") +
  geom_text(aes(x=Day, y=Attacked, label = Attacked), vjust = -1) +
  ggtitle(expression(bolditalic("Junonia coenia "))) +
  geom_errorbar( aes(x=Day, ymin=Attacked-SD, ymax=Attacked+SD), width=0.2, size=0.5) + 
  theme_classic() + 
  theme( aspect.ratio = 4/3, 
         plot.title = element_text(hjust = 0.5, size=17), 
         axis.title = element_text(size = 15), axis.text = element_text(size = 15)) +
  geom_line(data = p_value2j, 
            aes(x = x, y = y, group = 1)) +
  geom_line(data = p_value3j, 
            aes(x = x, y = y, group = 1)) + 
  geom_line(data = p_value4j, 
            aes(x = x, y = y, group = 1)) + 
  geom_text(x=1.5, y=19.75, label="n.s.") +
  geom_text(x=2, y=21.25, label="n.s.") +
  geom_text(x=2.5, y=22.75, label="n.s.") 
j.plot 
```

### Final Figure (Part 1)

```{r final figure}
figure = b.plot + j.plot 

# Remove title from second subplot
figure[[2]] = figure[[2]] + theme(axis.text.y = element_blank(),
                                        axis.ticks.y = element_blank(),
                                        axis.title.y = element_blank() )
figure
```

```{r save figure }
figure = b.plot + j.plot 

figure

ggsave(figure, file = "/Users/abbyrobinson/Desktop/Reviews/learning_figure.pdf", width=8, height=8, units=c("in"), useDingbats=FALSE)

```


## Quabbin Reservior Transect Map 

```{r load GIS data for map}
d <- curl("https://raw.githubusercontent.com/butterfliesrcool/Temporal_Synchrony_Predation_Experiments/main/data/Quabbin_GIS_Data.csv")
map <- read.csv(d, header = TRUE, sep = ",")
head(map)
```

```{r data filtering }
map <- subset(map, select = c(experiment, site, latitude, longitude) )
head(map)
```

```{r load google API}
register_google(key = "")
```

```{r Quabbin map figure }
quab.map <- ggmap(get_googlemap(center = c(lon = -72.30, lat = 42.398),
                    zoom = 12, scale = 2,
                    maptype ='roadmap',
                    color = 'color', 
                    style=c(feature="all",element="labels",visibility="off"))) + 
            geom_point(aes(x = longitude, y = latitude, shape = experiment, color = experiment), data = map, size = 4)  + 
            theme(legend.position="right", 
                    axis.title = element_text(size = 20, face="bold"), 
                    axis.text = element_text(size = 20),
                    legend.title = element_text(face ="bold")) + 
             xlab("Longitude") + ylab("Latitude") +  labs(color = "Experiment Type", shape = "Experiment Type" ) +
             scale_color_manual(breaks = c("one", "two", "four", "sim"), 
                                values = c("darkorchid4", "darkorchid4", "darkorchid4", "red3"), 
                                labels = c("Transect 1", "Transect 2", "Transect 3", "Transect 4")) + 
             scale_shape_manual(breaks = c("one", "two", "four", "sim"), 
                                values = c(17, 16, 15, 18), 
                                labels = c("Transect 1", "Transect 2", "Transect 3", "Transect 4"))
quab.map
ggsave(quab.map, file = "/Users/abbyrobinson/Desktop/Temporal Dynamics Project/quab.map.pdf", width=15, height=10, units=c("in"), useDingbats=FALSE)

```

```{r T0 map }
map_sim <- subset(map, experiment == "sim") 
map_sim

quab_map_sim <- ggmap(get_googlemap(center = c(lon = -72.30, lat = 42.398),
                    zoom = 12, scale = 2,
                    maptype ='roadmap',
                    color = 'color', 
                    style=c(feature="all",element="labels",visibility="off"))) + 
            geom_point(aes(x = longitude, y = latitude, color = experiment), data = map_sim, size = 4)  + 
            theme(legend.position="right", 
                    axis.title = element_text(size = 20, face="bold"), 
                    axis.text = element_text(size = 20),
                    legend.title = element_text(face ="bold")) + 
             xlab("Longitude") + ylab("Latitude") + 
             scale_color_manual( values = c("darkorange2"))
quab_map_sim
```

```{r T1 map }
map_one <- subset(map, experiment == "one") 
map_one

quab_map_one <- ggmap(get_googlemap(center = c(lon = -72.30, lat = 42.398),
                    zoom = 12, scale = 2,
                    maptype ='roadmap',
                    color = 'color', 
                    style=c(feature="all",element="labels",visibility="off"))) + 
            geom_point(aes(x = longitude, y = latitude, color = experiment), data = map_one, size = 4)  + 
            theme(legend.position="right", 
                    axis.title = element_text(size = 20, face="bold"), 
                    axis.text = element_text(size = 20),
                    legend.title = element_text(face ="bold")) + 
             xlab("Longitude") + ylab("Latitude") + 
             scale_color_manual( values = c("royalblue"))
quab_map_one
```

```{r T2 map }
map_two <- subset(map, experiment == "two") 
map_two

quab_map_two <- ggmap(get_googlemap(center = c(lon = -72.30, lat = 42.398),
                    zoom = 12, scale = 2,
                    maptype ='roadmap',
                    color = 'color', 
                    style=c(feature="all",element="labels",visibility="off"))) + 
            geom_point(aes(x = longitude, y = latitude, color = experiment), data = map_two, size = 4)  + 
            theme(legend.position="right", 
                    axis.title = element_text(size = 20, face="bold"), 
                    axis.text = element_text(size = 20),
                    legend.title = element_text(face ="bold")) + 
             xlab("Longitude") + ylab("Latitude") + 
             scale_color_manual( values = c("plum4"))
quab_map_two
```

```{r T4 map }
map_four <- subset(map, experiment == "four") 
map_four

quab_map_four <- ggmap(get_googlemap(center = c(lon = -72.30, lat = 42.398),
                    zoom = 12, scale = 2,
                    maptype ='roadmap',
                    color = 'color', 
                    style=c(feature="all",element="labels",visibility="off"))) + 
            geom_point(aes(x = longitude, y = latitude, color = experiment), data = map_four, size = 4)  + 
            theme(legend.position="right", 
                    axis.title = element_text(size = 20, face="bold"), 
                    axis.text = element_text(size = 20),
                    legend.title = element_text(face ="bold")) + 
             xlab("Longitude") + ylab("Latitude") + 
             scale_color_manual( values = c("red4"))
quab_map_four
```

## Testing phase figure 

### Prepping Figure Data 

```{r aggregate by treatment}
# isolate each treatment type to visualize patterns of attack 
four_weeks   <- subset(mimic, treatment == "four", drop = FALSE) 
two_weeks    <- subset(mimic, treatment == "two", drop = FALSE) 
one_week     <- subset(mimic, treatment == "one", drop = FALSE) 
simultaneous <- subset(mimic, treatment == "zero", drop = FALSE)

four_attacks  <- aggregate(x=four_weeks$attacks, by = list(four_weeks$species), FUN=sum)
two_attacks   <- aggregate(x=two_weeks$attacks, by = list(two_weeks$species), FUN=sum)
one_attacks   <- aggregate(x=one_week$attacks, by = list(one_week$species), FUN=sum)
zero_attacks  <- aggregate(x=simultaneous$attacks, by = list(simultaneous$species), FUN=sum)
```

### Confidence Intervals 

```{r calculate SD}
# subset each species within each treatment to calculate a confidence interval for the proportion of facsimiles of each species attacked 

  # four week experiment 
lim4 <- subset(four_weeks, species == "limenitis", drop = FALSE)
jun4 <- subset(four_weeks, species == "junonia", drop = FALSE)

  # two week experiment 
lim2 <- subset(two_weeks, species == "limenitis", drop = FALSE)
jun2 <- subset(two_weeks, species == "junonia", drop = FALSE)

  # one week experiment 
lim1 <- subset(one_week, species == "limenitis", drop = FALSE)
jun1 <- subset(one_week, species == "junonia", drop = FALSE)

  # simultaneous experiment 
lim0 <- subset(simultaneous, species == "limenitis", drop = FALSE)
jun0 <- subset(simultaneous, species == "junonia", drop = FALSE)


# calculate standard deviation of attacked proportion 

  # four week experiment 
lim4.sd <- sd(lim4$attacks)
jun4.sd <- sd(jun4$attacks)

  # two week experiment 
lim2.sd <- sd(lim2$attacks)
jun2.sd <- sd(jun2$attacks)

  # one week experiment 
lim1.sd <- sd(lim1$attacks)
jun1.sd <- sd(jun1$attacks)

  # simultaneous experiment 
lim0.sd <- sd(lim0$attacks)
jun0.sd <- sd(jun0$attacks)
```

```{r new data frame with SD}
# create a new data frame with the species info, attack proportion, and confidence interval for each treatment 

  # four week experiment 
four_plot_data <- data.frame(
  Species  = four_attacks$Group.1,
  Attacks  = four_attacks$x,
  SD       = c(jun4.sd, lim4.sd)
)
four_plot_data

  # two week experiment 
two_plot_data <- data.frame(
  Species  = two_attacks$Group.1,
  Attacks  = two_attacks$x,
  SD       = c(jun2.sd, lim2.sd)
)
two_plot_data

  # one week experiment 
one_plot_data <- data.frame(
  Species = one_attacks$Group.1,
  Attacks = one_attacks$x,
  SD      = c(jun1.sd, lim1.sd)
)
one_plot_data

  # simultaneous experiment 
zero_plot_data <- data.frame(
  Species = zero_attacks$Group.1,
  Attacks = zero_attacks$x,
  SD      = c(jun0.sd, lim0.sd)
)
zero_plot_data
```

### Four Week Experiment Figure 

```{r testing phase figure }
four_plot <- ggplot(four_plot_data) +
             geom_bar_pattern(aes(Species, Attacks, pattern = Species),
                   stat = "identity", 
                   fill= c("gray35", "gray70"), 
                   width = 0.8, 
                   pattern_fill = "white",
                   pattern_angle = 90,
                   pattern_density = 0.1,
                   pattern_spacing = 0.05) + 
             ylim(0,20)  + xlab(expression(bold("Four-Week Treatment"))) +  ylab("Facsimiles Attacked") + 
             geom_text(aes(x=Species, y=Attacks, label = Attacks), vjust = -1) +
             scale_x_discrete(limits =  c("limenitis", "junonia"), 
                              labels = c("limenitis" = expression(italic("L. arthemis ")),"junonia" = expression(italic("J. coenia ")))) + 
             scale_pattern_manual(values=c('none', 'none')) + 
             geom_errorbar( aes(x=Species, ymin=Attacks-SD, ymax=Attacks+SD), width=0.2, size=0.5) + 
             theme_classic() +
             theme( aspect.ratio = 4/3, 
                    axis.title = element_text(size = 12), 
                    axis.text = element_text(size = 10), 
                    legend.position = "none") 


two_plot <- ggplot(two_plot_data) +
             geom_bar_pattern(aes(Species, Attacks, pattern = Species),
                   stat = "identity", 
                   fill= c("gray35", "gray70"), 
                   width = 0.8, 
                   pattern_fill = "white",
                   pattern_angle = 90,
                   pattern_density = 0.7,
                   pattern_spacing = 0.05) + 
             ylim(0,20)  + xlab(expression(bold("Two-Week Treatment"))) + ylab("Facsimiles Attacked") + 
             geom_text(aes(x=Species, y=Attacks, label = Attacks), vjust = -1) +
             scale_x_discrete(limits =  c("limenitis", "junonia"), 
                              labels = c("limenitis" = expression(italic("L. arthemis ")),"junonia" = expression(italic("J. coenia ")))) + 
             scale_pattern_manual(values=c('none', 'none')) + 
             geom_errorbar( aes(x=Species, ymin=Attacks-SD, ymax=Attacks+SD), width=0.2, size=0.5) + 
             geom_text(aes(x=Species, y=Attacks, label = Attacks), vjust = -1) +
             theme_classic() +
             theme( aspect.ratio = 4/3, 
                    axis.title = element_text(size = 12), 
                    axis.text = element_text(size = 10), 
                    legend.position = "none") 

one_plot <- ggplot(one_plot_data) +
             geom_bar_pattern(aes(Species, Attacks, pattern = Species),
                   stat = "identity", 
                   fill= c("gray35", "gray70"), 
                   width = 0.8, 
                   pattern_fill = "white",
                   pattern_angle = 45,
                   pattern_density = 0.9,
                   pattern_spacing = 0.05) + 
             ylim(0,20)  + xlab(expression(bold("One-Week Treatment"))) + ylab("Facsimiles Attacked") + 
             geom_text(aes(x=Species, y=Attacks, label = Attacks), vjust = -1) +
             scale_x_discrete(limits =  c("limenitis", "junonia"), 
                              labels = c("limenitis" = expression(italic("L. arthemis ")),"junonia" = expression(italic("J. coenia ")))) + 
             scale_pattern_manual(values=c('none', 'none')) + 
             geom_errorbar( aes(x=Species, ymin=Attacks-SD, ymax=Attacks+SD), width=0.2, size=0.5) + 
             theme_classic() +
             theme( aspect.ratio = 4/3, 
                    axis.title = element_text(size = 12), 
                    axis.text = element_text(size = 10), 
                    legend.position = "none") 

one_plot  

p_value <- tibble(
  x = c("limenitis", "limenitis", "junonia", "junonia"),
  y = c(18, 19, 19, 18)
)

zero_plot <- ggplot(zero_plot_data) +
             geom_bar_pattern(aes(Species, Attacks, pattern = Species),
                   stat = "identity", 
                   fill= c("gray35", "gray70"), 
                   width = 0.8, 
                   pattern_fill = "white",
                   pattern_angle = 45,
                   pattern_density = 0.1,
                   pattern_spacing = 0.05) + 
             geom_line(data = p_value, aes(x = x, y = y, group = 1)) +
             ylim(0,20)  + xlab(expression(bold("Simultaneous Treatment"))) +  ylab("Facsimiles Attacked (%)") + 
             geom_text(aes(x=Species, y=Attacks, label = Attacks), vjust = -1) +
             scale_x_discrete(limits =  c("limenitis", "junonia"), 
                              labels = c("limenitis" = expression(italic("L. arthemis ")),"junonia" = expression(italic("J. coenia ")))) + 
             scale_pattern_manual(values=c('none', 'none')) + 
             geom_errorbar( aes(x=Species, ymin=Attacks-SD, ymax=Attacks+SD), width=0.2, size=0.5) + 
             theme_classic() +
             theme( aspect.ratio = 4/3, 
                    axis.title = element_text(size = 12), 
                    axis.text = element_text(size = 10), 
                    legend.position = "none") 


fig = zero_plot + one_plot + two_plot + four_plot 

fig[[1]] = fig[[1]] + theme(axis.title.x = element_blank(), 
                            axis.text.x = element_blank())

fig[[2]] = fig[[2]] + theme(axis.title.y = element_blank(), 
                            axis.title.x = element_blank(), 
                            axis.text.x = element_blank())

fig[[3]] = fig[[3]] + theme(axis.title.y = element_blank(),
                            axis.title.x = element_blank(), 
                            axis.text.x = element_blank())

fig[[4]] = fig[[4]] + theme(axis.title.y = element_blank(), 
                            axis.title.x = element_blank(), 
                            axis.text.x = element_blank())

attack.fig <- fig + plot_layout(nrow=1)
attack.fig

ggsave(attack.fig, file = "/Users/abbyrobinson/Desktop/Temporal Dynamics Project/attack_fig.pdf", width=8, height=8, units=c("in"), useDingbats=FALSE)

```

```{r alternative figure }
four_plot <- ggplot(four_plot_data) +
             geom_bar_pattern(aes(Species, Attacks, pattern = Species),
                   stat = "identity", 
                   fill= c("gray35", "white"), 
                   width = 0.8, 
                   pattern_fill = "white",
                   pattern_angle = 90,
                   pattern_density = 0.1,
                   pattern_spacing = 0.05) + 
             ylim(0,20)  + xlab(expression(bold("Four-Week Treatment"))) +  ylab("Facsimiles Attacked") + 
             scale_x_discrete(limits =  c("limenitis", "junonia"), 
                              labels = c("limenitis" = expression(italic("L. arthemis ")),"junonia" = expression(italic("J. coenia ")))) + 
             scale_pattern_manual(values=c('none', 'crosshatch')) + 
             geom_errorbar( aes(x=Species, ymin=Attacks-SD, ymax=Attacks+SD), width=0.2, size=0.5) + 
             theme_classic() +
             theme( aspect.ratio = 4/3, 
                    axis.title = element_text(size = 15), 
                    axis.text = element_text(size = 15), 
                    legend.position = "none") 


two_plot <- ggplot(two_plot_data) +
             geom_bar_pattern(aes(Species, Attacks, pattern = Species),
                   stat = "identity", 
                   fill= c("gray35", "white"), 
                   width = 0.8, 
                   pattern_fill = "white",
                   pattern_angle = 90,
                   pattern_density = 0.7,
                   pattern_spacing = 0.05) + 
             ylim(0,20)  + xlab(expression(bold("Two-Week Treatment"))) + ylab("Facsimiles Attacked") + 
             scale_x_discrete(limits =  c("limenitis", "junonia"), 
                              labels = c("limenitis" = expression(italic("L. arthemis ")),"junonia" = expression(italic("J. coenia ")))) + 
             scale_pattern_manual(values=c('none', 'circle')) + 
             geom_errorbar( aes(x=Species, ymin=Attacks-SD, ymax=Attacks+SD), width=0.2, size=0.5) + 
             theme_classic() +
             theme( aspect.ratio = 4/3, 
                    axis.title = element_text(size = 15), 
                    axis.text = element_text(size = 15), 
                    legend.position = "none") 

one_plot <- ggplot(one_plot_data) +
             geom_bar_pattern(aes(Species, Attacks, pattern = Species),
                   stat = "identity", 
                   fill= c("gray35", "white"), 
                   width = 0.8, 
                   pattern_fill = "white",
                   pattern_angle = 45,
                   pattern_density = 0.9,
                   pattern_spacing = 0.05) + 
             ylim(0,20)  + xlab(expression(bold("One-Week Treatment"))) + ylab("Facsimiles Attacked") + 
             scale_x_discrete(limits =  c("limenitis", "junonia"), 
                              labels = c("limenitis" = expression(italic("L. arthemis ")),"junonia" = expression(italic("J. coenia ")))) + 
             scale_pattern_manual(values=c('none', 'wave')) + 
             geom_errorbar( aes(x=Species, ymin=Attacks-SD, ymax=Attacks+SD), width=0.2, size=0.5) + 
             theme_classic() +
             theme( aspect.ratio = 4/3, 
                    axis.title = element_text(size = 15), 
                    axis.text = element_text(size = 15), 
                    legend.position = "none") 

one_plot  

p_value <- tibble(
  x = c("limenitis", "limenitis", "junonia", "junonia"),
  y = c(18, 19, 19, 18)
)

zero_plot <- ggplot(zero_plot_data) +
             geom_bar_pattern(aes(Species, Attacks, pattern = Species),
                   stat = "identity", 
                   fill= c("gray35", "white"), 
                   width = 0.8, 
                   pattern_fill = "white",
                   pattern_angle = 45,
                   pattern_density = 0.1,
                   pattern_spacing = 0.05) + 
             geom_line(data = p_value, aes(x = x, y = y, group = 1)) +
             ylim(0,20)  + xlab(expression(bold("Simultaneous Treatment"))) +  ylab("Facsimiles Attacked (%)") + 
             scale_x_discrete(limits =  c("limenitis", "junonia"), 
                              labels = c("limenitis" = expression(italic("L. arthemis ")),"junonia" = expression(italic("J. coenia ")))) + 
             scale_pattern_manual(values=c('none', 'crosshatch')) + 
             geom_errorbar( aes(x=Species, ymin=Attacks-SD, ymax=Attacks+SD), width=0.2, size=0.5) + 
             theme_classic() +
             theme( aspect.ratio = 4/3, 
                    axis.title = element_text(size = 15), 
                    axis.text = element_text(size = 15), 
                    legend.position = "none") 


fig = four_plot + two_plot + one_plot + zero_plot

fig[[1]] = fig[[1]] + theme(axis.title.x = element_blank(), 
                            axis.text.x = element_blank())

fig[[2]] = fig[[2]] + theme(axis.title.y = element_blank(), 
                            axis.title.x = element_blank(), 
                            axis.text.x = element_blank())

fig[[3]] = fig[[3]] + theme(axis.title.x = element_blank(), 
                            axis.text.x = element_blank())

fig[[4]] = fig[[4]] + theme(axis.title.y = element_blank(), 
                            axis.title.x = element_blank(), 
                            axis.text.x = element_blank())

attack.fig <- fig + plot_layout(nrow=2)
attack.fig
```
